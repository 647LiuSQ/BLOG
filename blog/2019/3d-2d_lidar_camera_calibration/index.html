<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<title>

  Shiqi Liu


  | Camera Lidar Calibration

</title>
<meta name="description" content="A simple, whitespace theme for academics. Based on [*folio](https://github.com/bogoli/-folio) design.
">

<!-- Open Graph -->


<!-- Bootstrap & MDB -->
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet" integrity="sha512-MoRNloxbStBcD8z3M/2BmnT+rg4IsMxPkXaGh2zD6LGNNFE80W3onsAhRcMAMrSoyWL9xD7Ert0men7vR8LUZg==" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/css/mdb.min.css" integrity="sha512-RO38pBRxYH3SoOprtPTD86JFOclM51/XTIdEPh5j8sj4tp8jmQIx26twG52UaLi//hQldfrh7e51WzP9wuP32Q==" crossorigin="anonymous" />

<!-- Fonts & Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css"  integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.0/css/academicons.min.css" integrity="sha512-W4yqoT1+8NLkinBLBZko+dFB2ZbHsYLDdr50VElllRcNt2Q4/GSs6u71UHKxB7S6JEMCp5Ve4xjh3eGQl/HRvg==" crossorigin="anonymous">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons">

<!-- Code Syntax Highlighting -->
<link rel="stylesheet" href="https://gitcdn.link/repo/jwarby/jekyll-pygments-themes/master/github.css" />

<!-- Styles -->

<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üçÄ</text></svg>">

<link rel="stylesheet" href="/BLOG/assets/css/main.css">
<link rel="canonical" href="/BLOG/blog/2019/3d-2d_lidar_camera_calibration/">

<!-- JQuery -->
<!-- jQuery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>


<!-- Theming-->

<script src="/BLOG/assets/js/theme.js"></script>
<script src="/BLOG/assets/js/dark_mode.js"></script>






    
<!-- MathJax -->
<script type="text/javascript">
  window.MathJax = {
    tex: {
      tags: 'ams'
    }
  };
</script>
<script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script>
<script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>


    <script src="/BLOG/assets/js/distillpub/template.v2.js"></script>
    <script src="/BLOG/assets/js/distillpub/transforms.v2.js"></script>
    <script src="/BLOG/assets/js/distillpub/overrides.js"></script>
    
  </head>

  <d-front-matter>
    <script async type="text/json">{
      "title": "Camera Lidar Calibration",
      "description": "These are tidbits of my internship in Hesaitech.",
      "published": "April 12, 2019",
      "authors": [
        
        {
          "author": "Shiqi Liu",
          "authorURL": "",
          "affiliations": [
            {
              "name": "",
              "url": ""
            }
          ]
        }
        
      ],
      "katex": {
        "delimiters": [
          {
            "left": "$",
            "right": "$",
            "display": false
          },
          {
            "left": "$$",
            "right": "$$",
            "display": true
          }
        ]
      }
    }</script>
  </d-front-matter>

  <body class="fixed-top-nav sticky-bottom-footer">

    <!-- Header -->

    <header>

    <!-- Nav Bar -->
    <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top">
    <div class="container">
      
      <a class="navbar-brand title font-weight-lighter" href="http://localhost:4000/BLOG/">
          <!--       Shiqi Liu -->
      </a>
      
      <!-- Navbar Toggle -->
      <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar top-bar"></span>
        <span class="icon-bar middle-bar"></span>
        <span class="icon-bar bottom-bar"></span>
      </button>
      <div class="collapse navbar-collapse text-right" id="navbarNav">
        <ul class="navbar-nav ml-auto flex-nowrap">
          <!-- About -->
          <li class="nav-item ">
            <a class="nav-link" href="/BLOG/">
              Home
              
            </a>
          </li>
          
          <!-- Blog -->
          <li class="nav-item active">
            <a class="nav-link" href="/BLOG/blog/">
              Blog
              
            </a>
          </li>
          
          <!-- Other pages -->
          
          
          
          
          
          
          <li class="nav-item ">
              <a class="nav-link" href="/BLOG/publications/">
                Publications
                
              </a>
          </li>
          
          
          
          
          
          
          
          
          
          <li class="nav-item ">
              <a class="nav-link" href="/BLOG/socialpapers/">
                Social Science
                
              </a>
          </li>
          
          
          
          
          
          <li class="nav-item ">
              <a class="nav-link" href="/BLOG/others/">
                Miscellaneous
                
              </a>
          </li>
          
          
          
          
            <div class = "toggle-container">
              <a id = "light-toggle">
                  <i class="fas fa-moon"></i>
                  <i class="fas fa-sun"></i>
              </a>
            </div>
          
        </ul>
      </div>
    </div>
  </nav>

</header>


    <!-- Content -->

    <div class="post distill">

      <d-title>
        <h1>Camera Lidar Calibration</h1>
        <p>These are tidbits of my internship in Hesaitech.</p>
      </d-title>

      <d-byline></d-byline>

      <d-article>
        <p>Alignment of camera and lidar has important implications for computer vision applications. We need to obtain the external parameters from the radar to the camera (that is, how the radar coordinate system is transformed to the camera coordinate system through a rigid body) when the internal parameters of the camera are known, including the rotation matrix R and translation t.</p>
<p>The correspondence between the point cloud in the radar coordinate system and the points on the pixel plane is as follows:</p>
<p><img src="../../../assets/img/Camera lidar calibration1.png" width="600" alt="avatar" /></p>
<p>Assume that the radar coordinate system is the world coordinate system. one point is<br />
$$ (x_w,y_w,z_w)^T. $$<br />
Transformed to the camera coordinate system after R, t, that is<br />
$$ (x_c,y_c,z_c)^T=R(x_w,y_w,z_w)^T+t^T $$<br />
Coordinates projected onto the imaging plane with Z=1<br />
$$ p=(x_1,y_1)^T=(x_c/z_c,y_c/z_c)^T $$<br />
<img src="../../../assets/img/Camera lidar calibration2.png" width="600" alt="avatar" /></p>
<p>Get new coordinates after distortion transformation<br />
$$ (x_D,y_D)^T=\phi_D(x_1,y_1)^T $$<br />
Get the coordinates of the last pixel plane through the internal reference matrix K<br />
$$ (x_p,y_p)^T=(x_D,y_D)^T K^T. $$<br />
We simply say that the entire mapping function above is<br />
$$ (x_p,y_p)^T=f(x_w,y_w,z_w) $$</p>
<p>In order to obtain the external parameters R and t, we use an original calibration method, which we call L2L(3d-2d). We use the mapping relationship from the 3D line to the 2D line to implement: specifically, the relationship that the corresponding pixel points in 2D are on the straight line projected from 3D to 2D. (The 3D line is still a line after being projected to 2D. We use the intersection of two surfaces in 3D to determine the line in 3D. The surface parameters in 3D are calculated by several points in the point cloud on it. We use several pixels in the pixel space to represent the lines in 2D.) We hope that the distance between the corresponding pixels in 2D and the straight line projected from 3D to 2D should be as small as possible, so the calculation is done by the pixel The distance of a point to a 3D line projected onto the pixel plane forms our optimization function. In the case of a given initial value, the objective function obtained by minimizing a series of corresponding line pairs is obtained to obtain optimized external parameters.</p>
<p>Suppose<br />
$$ (x_w^{1},y_w^{1},z_w^{1})^T,(x_w^{2},y_w^{2},z_w^{2})^T $$<br />
is two points on the 3D line, then the line projected by the 3D line in 2D can be represented by the two points projected on it (the default distortion has little effect and will not make the line curved.)<br />
$$ (x_p^{1},y_p^{1})^T=f(x_w^{1},y_w^{1},z_w^{1}),(x_p^{2},y_p^{2})^T=f(x_w^{2},y_w^{2},z_w^{2}). $$<br />
<img src="../../../assets/img/Camera lidar calibration3.png" width="600" alt="avatar" /></p>
<p>Then we can find the equation of the straight line<br />
$$ Ax+By+C=0. $$<br />
For several known pixel points on a straight line<br />
$$ (x_p^a,y_p^a)^T,(x_p^b,y_p^b)^T,\cdots, $$<br />
Its distance to the straight line is<br />
$$ d^a=\vert\frac{Ax_p^a+By_p^a+C}{\sqrt{A^2+B^2}} \vert,\cdots, $$<br />
The objective function of a line is constructed:<br />
$$ L_{line1}=d^a+d^b+\cdots, $$<br />
The objective function for all lines then becomes<br />
$$ totalLoss=L_{line1}+L_{line2}+\cdots. $$</p>
<p>It is noted that the projection to the Z=1 plane is a nonlinear operation during the whole process, which makes the entire loss nonlinear and very complicated with respect to R and t, and cannot be solved directly analytically. We use the global optimization function basinhopping in scipy's optimize in python to optimize the objective function with respect to R, t.</p>
<p>Since bashihoping is a global optimization function, it is greatly affected by the initial value of the search. And R is not well suited for direct optimization because its degrees of freedom are lower than its number of variables. So we use the Euler angle RPY to describe the R matrix (the space from the Euler angle to the R matrix is a surjection. By enumerating the RPY feasible region and taking points as the initial value of the bashihoping function to optimize. We will try 0 and 180¬∞ as the initial value for each dimension, a total of 8 situations, and empirically, good results can be obtained under the 4 initial values.</p>
<p>We have also tried the method of using point-to-point correspondence to solve the external parameters, that is, replacing the distance from point to line with the distance from point to point, but we found that it is difficult to determine the correspondence between 3D points and 2D points. After verifying that its solution effect is very poor, we finally gave up this method.</p>

      </d-article>

      <d-appendix>
        <d-footnote-list></d-footnote-list>
        <d-citation-list></d-citation-list>
      </d-appendix>

    </div>

    <!-- Footer -->

    
<footer class="sticky-bottom mt-5">
  <div class="container">
    &copy; Copyright 2023 Shiqi  Liu.
    
    
    
    Last updated: October 05, 2023.
    
  </div>
</footer>



  </body>

  <d-bibliography src="/BLOG/assets/bibliography/">
  </d-bibliography>

</html>
